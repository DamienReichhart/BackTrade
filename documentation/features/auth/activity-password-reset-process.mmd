flowchart TD
    Start([User navigates to forgot password page]) --> RenderStep1[Render Step 1: Request Reset Code]
    RenderStep1 --> UserInputEmail[User enters email]
    
    UserInputEmail --> ValidateEmail{Email valid?}
    ValidateEmail -->|No| ShowEmailError[Display email validation error]
    ShowEmailError --> UserInputEmail
    
    ValidateEmail -->|Yes| UserSubmitEmail[User clicks Send Code button]
    UserSubmitEmail --> CallRequestAPI[POST /auth/users/requester/password<br/>{ email }]
    
    CallRequestAPI --> RequestCheck{API Response?}
    
    RequestCheck -->|200 OK| RenderStep2[Render Step 2: Reset Password]
    RenderStep2 --> UserInputCode[User enters verification code]
    UserInputCode --> UserInputPassword[User enters new password]
    
    UserInputPassword --> ValidatePassword{Password valid?}
    ValidatePassword -->|No| ShowPasswordError[Display password validation error]
    ShowPasswordError --> UserInputPassword
    
    ValidatePassword -->|Yes| CheckCode{Code entered?}
    CheckCode -->|No| ShowCodeError[Display code required error]
    ShowCodeError --> UserInputCode
    
    CheckCode -->|Yes| UserSubmitReset[User clicks Reset Password button]
    UserSubmitReset --> CallResetAPI[POST /auth/users/resetter/password<br/>{ code, newPassword }]
    
    CallResetAPI --> ResetCheck{API Response?}
    
    ResetCheck -->|200 OK or 204 No Content| NavigateLogin[Navigate to /signin]
    NavigateLogin --> End([Password reset successful])
    
    ResetCheck -->|403 Forbidden<br/>Invalid code| ShowInvalidCodeError[Display invalid code error]
    ShowInvalidCodeError --> UserInputCode
    
    ResetCheck -->|Network Error| ShowResetError[Display reset error]
    ShowResetError --> UserInputCode
    
    RequestCheck -->|404 Not Found<br/>User not found| ShowUserNotFoundError[Display user not found error]
    ShowUserNotFoundError --> UserInputEmail
    
    RequestCheck -->|Network Error| ShowRequestError[Display request error]
    ShowRequestError --> UserInputEmail
    
    RenderStep2 --> BackButton[User clicks Back button]
    BackButton --> RenderStep1
    
    style Start fill:#e1f5ff
    style End fill:#c8e6c9
    style ShowEmailError fill:#fff3e0
    style ShowPasswordError fill:#fff3e0
    style ShowCodeError fill:#fff3e0
    style ShowUserNotFoundError fill:#ffcdd2
    style ShowInvalidCodeError fill:#ffcdd2
    style ShowRequestError fill:#ffcdd2
    style ShowResetError fill:#ffcdd2
    style RenderStep2 fill:#e3f2fd

